# pkk-cache
## Описание
Данный скрипт делает запрос к сайту https://pkk.rosreestr.ru, созраняет скачанный файл на диск и выдаёт для отображения.
Создавался для JOSM, однако может использоваться и для других програм.

## Установка
1. Установите Python
  https://www.python.org/downloads/

2. Добавьте 2 библиотеки (введите в консоли):
```
pip install flask
pip install Pillow
```
Если не получилось, введите «pip3» вместо «pip»

3. Скачайте файл pkk-cache.py
  https://github.com/Grass-snake-89/pkk-cache

4. Запустите терминал в директории с файлом.
    - При работе в **Linux** выполните команду:
    ```
    export FLASK_APP=pkk-cache && flask run
    ```
    Примечание: если не получилось, попробуйте выполнить две отдельные команды:
    ```
    export FLASK_APP=pkk-cache
    flask run
    ```

    - При работе в **Windows** выполните команду:

    ```
    set FLASK_APP=pkk-cache && flask run
    ```
    Примечание: если не получилось, попробуйте выполнить две отдельные команды:

    ```
    set FLASK_APP=pkk-cache
    flask run
    ```

    - Другие способы запуска (**Fish**, **Powershell**) указаны на странице [Документацию Flask](https://flask.palletsprojects.com/en/2.1.x/quickstart/).

5. Откройте браузер и введите в адресной строке:
  127.0.0.1:5000
Должна появиться надпись «It works!». Если да, то значит скорее всего всё работает.

6. Запустите JOSM, выберите «Слои» → «Настройки слоёв»
В окне настроек нажмите кнопку «+ WMS»

7. В появившемся окне в пункте 6 введите ссылку в соответствии с нужным слоем (смотрите ниже),
в пункте 7 укажите название слоя (любое чтобы Вам было удобно):

Публичная кадастровая карта — Земельные участки
```
wms:http://127.0.0.1:5000/path/land?bbox={bbox}
```

Публичная кадастровая карта — Здания и сооружения
```
wms:http://127.0.0.1:5000/path/building?bbox={bbox}
```

Публичная кадастровая карта — Границы единиц АТД и населённых пунктов
```
wms:http://127.0.0.1:5000/path/boundary?bbox={bbox}
```

Публичная кадастровая карта — Зоны и территории
```
wms:http://127.0.0.1:5000/path/zone?bbox={bbox}
```

Нажмите ОК в двух окнах.

8. Теперь выберине нужный слой («Слои» → Название слоя, который вы указали в предыдущем пункте)

Всё, должно работать. Если не заработало, пишите мне, буду разбираться.

Примечание: Иногда бывает, что скачивание происходит с ошибкой. Если подождать 5-10 секунд, то JOSM должен сам повторно обратиться к пропущенному тайлу. Если этого не произошло, в окне выбора слоя нажмите правой кнопкой мыши по слою и выберите «Скачать все квадраты с ошибками».

Обычно со 2-3 раза скачиваются все квадраты.
